<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
    <meta name="theme-color" content="#5A9AD4"/>
    <title th:text="${trip.name} + ' — Resumen · Repartija'">Resumen — Repartija</title>
    <link rel="preconnect" href="https://fonts.googleapis.com"/>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:ital,opsz,wght@0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700&display=swap" rel="stylesheet"/>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <link th:href="@{/css/app.css}" rel="stylesheet"/>
    <style>input, select, textarea{font-size:16px}.btn{min-height:44px;display:inline-flex;align-items:center;justify-content:center}</style>
</head>
<body class="pb-4">
<div class="container app-container py-3 py-md-4">
    <nav class="app-nav mb-3">
        <a th:href="@{/}">Inicio</a>
        ·
        <a th:href="@{/trips/{id}(id=${trip.id})}" th:text="${trip.name}">Viaje</a>
    </nav>
    <h1 class="app-title" th:text="${trip.name} + ' — Resumen'">Resumen del viaje</h1>

    <p class="text-muted">Total pagado = lo que desembolsó cada uno. Total consumido = su parte de los gastos. Saldo: positivo = le deben, negativo = debe.</p>

    <div th:if="${#lists.isEmpty(summary)}" class="alert alert-info">No hay personas en el viaje o no hay gastos. Agrega personas y gastos para ver el resumen.</div>

    <div th:unless="${#lists.isEmpty(summary)}" class="table-responsive">
    <table class="table table-striped">
        <thead>
        <tr>
            <th>Persona</th>
            <th>Total pagado</th>
            <th>Total consumido</th>
            <th>Saldo</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="row : ${summary}">
            <td th:text="${row.personName}">Nombre</td>
            <td th:text="${#numbers.formatDecimal(row.totalPaid, 1, 2)}">0.00</td>
            <td th:text="${#numbers.formatDecimal(row.totalConsumed, 1, 2)}">0.00</td>
            <td th:class="${row.balance != null && row.balance.compareTo(T(java.math.BigDecimal).ZERO) > 0 ? 'text-success' : (row.balance != null && row.balance.compareTo(T(java.math.BigDecimal).ZERO) < 0 ? 'text-danger' : '')}" th:text="${#numbers.formatDecimal(row.balance, 1, 2)}">0.00</td>
        </tr>
        </tbody>
    </table>
    </div>

    <section th:unless="${#lists.isEmpty(summary)}" class="mt-4">
        <h2 class="h5 mb-3">Cómo saldar las cuentas</h2>
        <p class="text-muted small">Cada uno hace un solo pago (o los mínimos necesarios) para que todos queden a cero.</p>
        <div th:if="${#lists.isEmpty(transfers)}" class="alert alert-success">No hay deudas que saldar; los saldos están en cero.</div>
        <ul th:unless="${#lists.isEmpty(transfers)}" class="list-group">
            <li th:each="t : ${transfers}" class="list-group-item">
                <strong th:text="${t.fromName}">A</strong> paga <strong th:text="${#numbers.formatDecimal(t.amount, 1, 2)}">0</strong> a <strong th:text="${t.toName}">B</strong>
            </li>
        </ul>
    </section>

    <a th:href="@{/trips/{id}(id=${trip.id})}" class="btn btn-outline-secondary mt-3">Volver al viaje</a>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
